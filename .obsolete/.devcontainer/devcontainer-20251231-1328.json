{
    "name": "BareMetal C Student",
    "image": "ghcr.io/kongkrit/baremetal-c",

    "workspaceMount": "source=${localWorkspaceFolder},target=/BareMetal-C,type=bind",
    "workspaceFolder": "/BareMetal-C",

    // Force copy headers on creation - used by c_cpp_properties.json
    // .vscode name is safe because the it is relative to "workspaceFolder"
    "postCreateCommand": "if [ ! -d .vscode/sdcc-include ]; then mkdir -p .vscode/sdcc-include && cp -r /usr/share/sdcc/include/* .vscode/sdcc-include/; fi",

    // So we can find out whether we're inside our container
    "containerEnv": {
        "IS_BAREMETAL_C_CONTAINER": "true"
    },

    "customizations": {
        "vscode": {
            "extensions": [
                "ms-vscode.cpptools"
            ],
            "settings": {

                // --- Distraction-Free UI ---
                "extensions.ignoreRecommendations": true,
                "workbench.tips.enabled": false,
                "workbench.startupEditor": "none",
                
                "files.eol": "\n",

                // Configure IntelliSense for SDCC automatically
                "C_Cpp.default.compilerPath": "/usr/bin/sdcc",
                "C_Cpp.default.cStandard": "c99",
                "C_Cpp.default.intelliSenseMode": "clang-x86",
                "C_Cpp.default.includePath": [
                    "${workspaceFolder}/code/_headers", // user headers reside in /BareMetal-C/code/_headers
                    "/usr/share/sdcc/include"
                ],
                "C_Cpp.default.defines": [
                    "__SDCC",
                    "__SDCC_z80",
                    "__naked=",
                    "__critical=",
                    "__interrupt=",
                    "__at(x)=",
                    "__asm__(x)="
                ],

                // --- Hiding Complexity ---
                "files.exclude": {

                    // Configs
                    ".devcontainer*": true,
                    "**/.git": true,
                    "**/.gitattributes": true,
                    "**/.gitignore": true,
                    "**/.vscode": true,
                    "_vscode-extensions": true,
                    "student.code-workspace*": true,

                    // Build, Scripts, LICENSE, md, docs, sim, setup
                    "**/makefile": true,
                    "**/Makefile": true,
                    "**/*.bat": true,
                    "**/*.command": true,
                    "**/*.sh": true,
                    "**/*.ps1": true,
                    "**/LICENSE": true,
                    "**/*.md": true,
                    "docs-*": true,
                    "setup": true,
                    "sim": true,

                    // non-C source code
                    "**/*.s": true,
                    "**/*/rel_": true,
                    "**/*/lst_": true,

                    // Internal Folders
                    "code/_defaults": true,
                    "code/_headers": true,
                        
                    // Dummy ender
                    "IfYourFileNameIsThisYouDeserveIt_-_-_-": true
                },
                "search.exclude": {
                }
            }
        }
    },
    "remoteUser": "root"
}
